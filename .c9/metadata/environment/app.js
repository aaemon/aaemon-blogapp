{"filter":false,"title":"app.js","tooltip":"/app.js","undoManager":{"mark":0,"position":0,"stack":[[{"start":{"row":0,"column":0},"end":{"row":120,"column":0},"action":"insert","lines":["var bodyPrser = require(\"body-parser\"),","\tmongoose = require(\"mongoose\"),","\tmethodOverride = require(\"method-override\"),","\texpressSanitizer = require(\"express-sanitizer\"),","\texpress = require(\"express\");","\t","var app = express();","","app.set(\"view engine\", \"ejs\");","app.use(express.static(\"public\"));","app.use(bodyPrser.urlencoded({extended: true}));","app.use(expressSanitizer());","app.use(methodOverride(\"_method\"));","","//mongoose model config","var blogSchema = new mongoose.Schema({","\ttitle: String,","\timage: String,","\tbody: String,","\tcreated: {type: Date, default: Date.now}","});","var Blog = mongoose.model(\"Blog\", blogSchema);","// Blog.create({","// \ttitle: \"Test Blog\",","// \timage: \"https://pixabay.com/get/52e8d3474c52a914f6da8c7dda793f7f1636dfe2564c704c7d2c78d59f4bc258_340.jpg\",","// \tbody: \"hello this is a blog post\"","// }) ","app.get(\"/\", function(req, res) {","\tres.redirect(\"/blogs\");","});","app.get(\"/blogs\", function(req, res) {","\tBlog.find({}, function(err, blogs) {","\t\tif(err) {","\t\t\tconsole.log(err);","\t\t}","\t\telse {","\t\t\tres.render(\"index\", {blogs: blogs});","\t\t}","\t\t","\t});","\t\t","});   ","","//new route","app.get(\"/blogs/new\", function(req, res) {","\tres.render(\"new\");","});","","app.post(\"/blogs\", function(req, res) {","\treq.body.blog.body = req.sanitize(req.body.blog.body);","\tBlog.create(req.body.blog, function(err, newBlog) {","\t\tif(err) {","\t\t\tres.render(\"new\");","\t\t}","\t\telse {","\t\t\tres.redirect(\"/blogs\");","\t\t}","\t});","});","","app.get(\"/blogs/:id\", function(req, res) {","\tBlog.findById(req.params.id, function(err, foundBlog) {","\t\tif(err) {","\t\t\tres.redirect(\"/blogs\");","\t\t}","\t\telse {","\t\t\tres.render(\"show\", {blog: foundBlog});","\t\t}","\t});","});","","app.get(\"/blogs/:id/edit\", function(req, res) {","\tBlog.findById(req.params.id, function(err, foundBlog) {","\t\tif(err) {","\t\t\tres.render(\"/blogs\");","\t\t}","\t\telse {","\t\t\tres.render(\"edit\", {blog: foundBlog});","\t\t}","\t});","});","","mongoose.set('useFindAndModify', false); //added","","app.put(\"/blogs/:id\", function(req, res) {","\treq.body.blog.body = req.sanitize(req.body.blog.body);","\tBlog.findByIdAndUpdate(req.params.id, req.body.blog, function(err, updatedBlog) {","\t\tif(err) {","\t\t\tres.redirect(\"/blogs\");","\t\t}","\t\telse {","\t\t\tres.redirect(\"/blogs/\" + req.params.id);","\t\t}","\t});","});","","app.delete(\"/blogs/:id\", function(req, res) {","\tBlog.findByIdAndRemove(req.params.id, function(err) {","\t\tif(err) {","\t\t\tres.redirect(\"/blogs\");","\t\t}","\t\telse {","\t\t\tres.redirect(\"/blogs\");","\t\t}","\t});","});","","mongoose.connect(\"mongodb+srv://ammer:1214@cluster0-scvre.azure.mongodb.net/test?retryWrites=true&w=majority\", {","\tuseNewUrlParser: true,","\tuseCreateIndex: true,","\tuseUnifiedTopology: true","}).then(() => {","\tconsole.log(\"BLOGAPP IS CONNECTED TO THE MONGODB SERVER\");","}).catch(err => {","\tconsole.log(\"ERROR: \", err.message);","});","","app.listen(process.env.PORT, process.env.IP, function() {","\tconsole.log(\"The BLOGSITE SERVER IS RUNNING\");","});",""],"id":1}]]},"ace":{"folds":[],"scrolltop":1740,"scrollleft":0,"selection":{"start":{"row":120,"column":0},"end":{"row":120,"column":0},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":0},"timestamp":1583506874271,"hash":"ac4adfe913fac2a6abcee09382f39be04cea55ec"}